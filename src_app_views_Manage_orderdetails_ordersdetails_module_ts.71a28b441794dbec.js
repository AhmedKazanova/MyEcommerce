"use strict";(self.webpackChunkEcommerce=self.webpackChunkEcommerce||[]).push([["src_app_views_Manage_orderdetails_ordersdetails_module_ts"],{978:(E,g,u)=>{u.r(g),u.d(g,{OrdersdetailsModule:()=>a});var p=u(6895),c=u(9197),f=u(449),_=u(8724),I=u(5079),h=u(2340),t=u(4650),m=u(4463),Z=u(7185),v=u(5760);function b(o,r){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Oqu(e.order.orderDetails)}}function A(o,r){1&o&&(t.TgZ(0,"span",14),t._uU(1,"NoDetails"),t.qZA())}function x(o,r){1&o&&(t.TgZ(0,"span",18),t._uU(1,"DeliveredProgress"),t.qZA())}function D(o,r){1&o&&(t.TgZ(0,"span",19),t._uU(1,"Delivered"),t.qZA())}function T(o,r){1&o&&(t.TgZ(0,"span",20),t._uU(1,"NoDelivered"),t.qZA())}function C(o,r){if(1&o&&(t.TgZ(0,"div"),t.YNc(1,x,2,0,"span",15),t.YNc(2,D,2,0,"span",16),t.YNc(3,T,2,0,"span",17),t.qZA()),2&o){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",1==e.order.deliveredProgress&&0==e.order.delivered),t.xp6(1),t.Q6J("ngIf",1==e.order.delivered),t.xp6(1),t.Q6J("ngIf",0==e.order.delivered)}}function O(o,r){if(1&o&&(t.ynx(0),t.YNc(1,C,4,3,"div",3),t.BQk()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",0==e.order.clientCancle)}}function y(o,r){1&o&&(t.TgZ(0,"div")(1,"span",14),t._uU(2,"\u0627\u0648\u0631\u062f\u0631 \u0645\u0644\u063a\u064a \u0645\u0646 \u0627\u0644\u0639\u0645\u064a\u0644"),t.qZA()())}function q(o,r){1&o&&(t.TgZ(0,"div")(1,"span",14),t._uU(2,"\u0627\u0648\u0631\u062f\u0631 \u0645\u0631\u0641\u0648\u0636 \u0645\u0646 \u0627\u0644\u0627\u062f\u0645\u0646"),t.qZA()())}function P(o,r){1&o&&(t.TgZ(0,"span",14),t._uU(1,"\u0646\u0641\u0630\u062a \u0627\u0644\u0643\u0645\u064a\u0629 \u0645\u0646 \u0627\u0644\u0645\u062e\u0632\u0646"),t.qZA())}function U(o,r){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.productQuantity)}}function N(o,r){1&o&&(t.TgZ(0,"span",14),t._uU(1,"\u062a\u0645 \u0627\u0644\u062d\u0630\u0641 \u0644\u0645 \u064a\u0639\u062f \u0627\u0644\u0645\u0646\u062a\u062c \u0645\u0648\u062c\u0648\u062f \u0628\u0627\u0644\u0645\u062a\u062c\u0631"),t.qZA())}function Q(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"button",24),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2).$implicit,s=t.oxw();return t.KtG(s.DownUpdate(i))}),t._uU(1,"DownOrderUpdate"),t.qZA()}}function S(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"button",25),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2).$implicit,s=t.oxw();return t.KtG(s.ofStock(i))}),t._uU(1,"oFStock"),t.qZA()}}function k(o,r){if(1&o&&(t.ynx(0),t.YNc(1,Q,2,0,"button",22),t.YNc(2,S,2,0,"button",23),t.BQk()),2&o){const e=t.oxw().$implicit,n=t.oxw();t.xp6(1),t.Q6J("ngIf",n.tranformNumber(e.productQuantity)>0&&n.tranformNumber(e.productQuantity)<e.quantity&&0==e.adminDeleted&&0==n.order.deliveredProgress),t.xp6(1),t.Q6J("ngIf",n.tranformNumber(e.productQuantity)<=0&&0==n.order.deliveredProgress&&n.order.totalOrder!=n.totalOrder()&&n.tranformNumber(e.productQuantity)!=e.quantity)}}const H=function(o){return["/user/productdetails",o]};function J(o,r){if(1&o&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t.YNc(8,P,2,0,"span",4),t.YNc(9,U,2,1,"span",3),t.YNc(10,N,2,0,"span",4),t.qZA(),t.TgZ(11,"td"),t._uU(12),t.qZA(),t.TgZ(13,"td"),t._uU(14),t.qZA(),t.TgZ(15,"td"),t._UZ(16,"img",21),t.ALo(17,"translate"),t.ALo(18,"translate"),t.qZA(),t.TgZ(19,"td"),t._uU(20),t.qZA(),t.TgZ(21,"td"),t.YNc(22,k,3,2,"ng-container",3),t.qZA()()),2&o){const e=r.$implicit,n=r.index,i=t.oxw();t.xp6(2),t.Oqu(n+1),t.xp6(2),t.Oqu(e.productName),t.xp6(2),t.Oqu(e.savePriceProduct),t.xp6(2),t.Q6J("ngIf",i.tranformNumber(e.productQuantity)<=0&&0==e.adminDeleted),t.xp6(1),t.Q6J("ngIf",i.tranformNumber(e.productQuantity)>0&&0==e.adminDeleted),t.xp6(1),t.Q6J("ngIf",1==e.adminDeleted),t.xp6(2),t.Oqu(e.quantity),t.xp6(2),t.Oqu(i.getItemTotal(e)),t.xp6(2),t.s9C("src",i.url+e.productImage,t.LSH),t.s9C("alt",t.lcZ(17,14,"ProductImage")),t.s9C("title",t.lcZ(18,16,"ProductImage")),t.Q6J("routerLink",t.VKq(18,H,e.productID)),t.xp6(4),t.Oqu(e.productDescription),t.xp6(2),t.Q6J("ngIf",0==i.order.clientCancle&&0==i.order.adminRefuse)}}class l{constructor(r,e,n,i,s){this._TranslateService=r,this.toastr=e,this._ApiserviceService=n,this._Router=i,this._ActivatedRoute=s,this.SubscriptionArr=[],this.url=`${h.N.imageUrl}`,this.lang="",this.orderItems=[],this.order={orderID:0,userId:"",orderDetails:"",userAddress:"",orderSaw:!1,totalOrder:0,orderDate:"",delivered:!1,deliveredProgress:!1,orderReturns:!1,orderItems:[],clientCancle:!1,adminRefuse:!1,clientDeleted:!1,adminDeleted:!1,user:"",userPhone:""}}ngOnInit(){this.language(),this.startConnection(),this.getorderDateils(),this.getAllUser(),"Connecting"==this.Hub_Connection?.state?(this.askServerOrderProgress(),this.askServerDeleteProduct(),this.askServerUpdateroduct()):alert("\u0647\u0646\u0627\u0643 \u062e\u0637\u0627 \u0645\u0646 \u0641\u0636\u0644\u0643 \u0627\u0639\u062f \u0627\u0644\u062a\u062d\u062f\u064a\u062b")}language(){this.lang=this._TranslateService.currentLang;let r=this._TranslateService.onLangChange.subscribe({next:e=>{this.lang=e.lang}});this.SubscriptionArr.push(r)}startConnection(){this.Hub_Connection=(new _.s).withUrl(`${h.N.signalrUrl}`,{skipNegotiation:!0,transport:I.n.WebSockets}).build(),this.Hub_Connection.start().then(()=>{}).catch(r=>{console.error("Error Hub Connection",r),alert("Error Hub Start Connection")})}getAllUser(){let r=this._ApiserviceService.getById("mangercontrol",this.order.userId).subscribe({next:e=>{this.user=e}});this.SubscriptionArr.push(r)}tranformNumber(r){return Number(r)}getorderDateils(){let r=this._ActivatedRoute.data.subscribe({next:e=>{if(null==e[0])this._Router.navigate(["/admin/settings"]);else{this.order=e[0];let n=e[0].orderItems;this.orderItems=e[0].orderItems.map(i=>i.product);for(let i=0;i<n.length;i++)this.orderItems[i].quantity=n[i].quantity,this.orderItems[i].savePriceProduct=n[i].savePriceProduct}}});this.SubscriptionArr.push(r)}getItemTotal(r){return r.quantity&&r.savePriceProduct&&r.quantity>0?Number(r.savePriceProduct)*r.quantity:0}totalOrder(){return this.orderItems.reduce((r,e)=>r+this.getItemTotal(e),0)}ofStock(r){"Disconnected"!=this.Hub_Connection?.state?"Connected"==this.Hub_Connection?.state&&0==Number(r.productQuantity)&&(r.ofStock=!0,this.orderItems.find(e=>e.productID==r.productID).quantity=Number(this.orderItems.find(e=>e.productID==r.productID).productQuantity),this.order.orderItems.find(e=>e.productID==r.productID).quantity=Number(this.orderItems.find(e=>e.productID==r.productID).productQuantity),this.Hub_Connection?.invoke("UpdateProduct",r.productID,r,this.lang).then(()=>{this.Hub_Connection?.invoke("orderUpdate",this.order.orderID,this.order).then(()=>{}).catch(e=>{console.error("Error Hub Connection",e),alert("Error Hub Start Connection")})}).catch(e=>{console.error("Error Hub Connection",e),alert("Error Hub Start Connection")})):alert("\u062a\u0627\u0643\u062f \u0645\u0646 \u0627\u062a\u0635\u0627\u0644\u0643 \u0628\u0627\u0644\u0627\u0646\u062a\u0631\u0646\u062a \u062b\u0645 \u0627\u0639\u062f \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0635\u0641\u062d\u0629")}askServerOrderProgress(){this.Hub_Connection?.on("orderProgress",r=>{if(r.orderID==this.order.orderID){if(this.order.delivered=r.delivered,this.order.deliveredProgress=r.deliveredProgress,this.order.orderReturns=r.orderReturns,this.order.totalOrder=r.totalOrder,0==r.delivered&&1==r.deliveredProgress)for(let e=0;e<this.orderItems.length;e++)for(let n=0;n<r.orderItems.length;n++)r.orderItems[n].productID==this.orderItems[e].productID&&(this.orderItems[e].productQuantity=""+(Number(this.orderItems[e].productQuantity)-Number(r.orderItems[n].quantity)));if(0==r.delivered&&0==r.deliveredProgress)for(let e=0;e<this.orderItems.length;e++)for(let n=0;n<r.orderItems.length;n++)r.orderItems[n].productID==this.orderItems[e].productID&&(this.orderItems[e].productQuantity=`${Number(this.orderItems[e].productQuantity)+Number(r.orderItems[n].quantity)}`);if(r.orderID!=this.order.orderID&&0==this.order.deliveredProgress){this.order.totalOrder=0;for(let e=0;e<this.order.orderItems.map(n=>n.product).length;e++)this.order.orderItems.map(n=>n.product)[e].productQuantity>=this.order.orderItems.map(n=>n.product)[e].quantity?this.order.totalOrder+=this.order.orderItems.map(n=>n.product)[e].quantity*this.order.orderItems.map(n=>n.product)[e].savePriceProduct:this.order.totalOrder+=this.order.orderItems.map(n=>n.product)[e].productQuantity*this.order.orderItems.map(n=>n.product)[e].savePriceProduct}}})}askServerUpdateroduct(){this.Hub_Connection?.on("UpdateProduct",(r,e)=>{if("Success"==e){this.toastr.success("en"==this.lang?"Update Product Success":"\u062a\u0645 \u0627\u0644\u062a\u0639\u062f\u064a\u0644 \u0628\u0646\u062c\u0627\u062d");let n=this.orderItems.find(i=>i.productID==r.productID);null!=n&&null!=n&&(n.adminDeleted=r.adminDeleted,n.categoryID=r.categoryID,n.ofStock=r.ofStock,n.productDescription=r.productDescription,n.productImage=r.productImage,n.productName=r.productName,n.productQuantity=r.productQuantity),this.order.totalOrder=0;for(let i=0;i<this.order.orderItems.map(s=>s.product).length;i++)this.order.orderItems.map(s=>s.product)[i].productQuantity>=this.order.orderItems.map(s=>s.product)[i].quantity?this.order.totalOrder+=this.order.orderItems.map(s=>s.product)[i].quantity*this.order.orderItems.map(s=>s.product)[i].savePriceProduct:this.order.totalOrder+=this.order.orderItems.map(s=>s.product)[i].productQuantity*this.order.orderItems.map(s=>s.product)[i].savePriceProduct}})}askServerDeleteProduct(){this.Hub_Connection?.on("DeleteProduct",(r,e)=>{if("Success"==e){let n=this.orderItems.find(i=>i.productID==r.productID);null!=n&&null!=n&&(n.adminDeleted=r.adminDeleted,n.productQuantity=r.productQuantity,this.totalOrder())}})}DownUpdate(r){"Disconnected"!=this.Hub_Connection?.state?"Connected"==this.Hub_Connection?.state&&(this.orderItems.find(e=>e.productID==r.productID).quantity=Number(this.orderItems.find(e=>e.productID==r.productID).productQuantity),this.order.orderItems.find(e=>e.productID==r.productID).quantity=Number(this.orderItems.find(e=>e.productID==r.productID).productQuantity),this.Hub_Connection?.invoke("orderUpdate",this.order.orderID,this.order).then(()=>{this.toastr.success("ar"==this.lang?"\u062a\u0645 \u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0627\u0648\u0631\u062f\u0631 \u0628\u0646\u062c\u0627\u062d":"Order Updated")}).catch(e=>console.error(e))):alert("\u062a\u0627\u0643\u062f \u0645\u0646 \u0627\u062a\u0635\u0627\u0644\u0643 \u0628\u0627\u0644\u0627\u0646\u062a\u0631\u0646\u062a \u062b\u0645 \u0627\u0639\u062f \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0635\u0641\u062d\u0629")}trackProduct(r,e){return e?e.productID:void 0}ngOnDestroy(){for(let r=0;r<this.SubscriptionArr.length;r++)this.SubscriptionArr[r].unsubscribe();this.Hub_Connection?.off(""),"Connecting"==this.Hub_Connection?.state&&this.Hub_Connection?.stop(),this.toastr.clear()}}l.\u0275fac=function(r){return new(r||l)(t.Y36(m.sK),t.Y36(Z._W),t.Y36(v.O),t.Y36(c.F0),t.Y36(c.gz))},l.\u0275cmp=t.Xpm({type:l,selectors:[["app-orderdetails"]],decls:57,vars:21,consts:[[1,"container-fluid"],[1,"fs-1","text-center","py-3"],[1,"d-block","my-2"],[4,"ngIf"],["class","text-danger",4,"ngIf"],[1,"d-flex","my-2"],[1,"table-responsive"],[1,"table","table-light","table-striped","table-hover"],[1,"col-1"],[1,"col-3"],[1,"col-4"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,""],["colspan","9",1,"py-3","text-white","bg-dark","noHover"],[1,"text-danger"],["class","mx-2 text-primary",4,"ngIf"],["class","mx-2 text-success",4,"ngIf"],["class","mx-2 text-danger",4,"ngIf"],[1,"mx-2","text-primary"],[1,"mx-2","text-success"],[1,"mx-2","text-danger"],["width","120","height","90",1,"rounded-3",3,"routerLink","src","alt","title"],["class","btn btn-warning",3,"click",4,"ngIf"],["class","btn btn-danger",3,"click",4,"ngIf"],[1,"btn","btn-warning",3,"click"],[1,"btn","btn-danger",3,"click"]],template:function(r,e){1&r&&(t.TgZ(0,"section",0)(1,"h1",1),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"span",2),t._uU(5),t.qZA(),t.TgZ(6,"span",2),t._uU(7),t.qZA(),t.TgZ(8,"span",2),t._uU(9),t.qZA(),t.TgZ(10,"span",2),t._uU(11,"OrderDetails : "),t.YNc(12,b,2,1,"span",3),t.YNc(13,A,2,0,"span",4),t.qZA(),t.TgZ(14,"span",2),t._uU(15),t.qZA(),t.TgZ(16,"span",2),t._uU(17),t.ALo(18,"date"),t.qZA(),t.TgZ(19,"span",2),t._uU(20),t.qZA(),t.TgZ(21,"span",5),t.YNc(22,O,2,1,"ng-container",3),t.YNc(23,y,3,0,"div",3),t.YNc(24,q,3,0,"div",3),t._uU(25," : OrderState "),t.qZA(),t.TgZ(26,"div",6)(27,"table",7)(28,"thead")(29,"tr")(30,"th",8),t._uU(31,"#"),t.qZA(),t.TgZ(32,"th",9),t._uU(33,"ProductName"),t.qZA(),t.TgZ(34,"th",8),t._uU(35,"ProductPrice"),t.qZA(),t.TgZ(36,"th",8),t._uU(37,"\u0627\u0644\u0645\u062a\u0628\u0642\u064a \u0641\u064a \u0627\u0644\u0645\u062e\u0632\u0646"),t.qZA(),t.TgZ(38,"th",8),t._uU(39,"Quantity"),t.qZA(),t.TgZ(40,"th",8),t._uU(41,"TotalItem"),t.qZA(),t.TgZ(42,"th",8),t._uU(43,"ProductImage"),t.qZA(),t.TgZ(44,"th",10),t._uU(45,"ProductDescription"),t.qZA(),t.TgZ(46,"th",10),t._uU(47,"Option"),t.qZA()()(),t.TgZ(48,"tbody"),t.YNc(49,J,23,20,"tr",11),t.qZA(),t.TgZ(50,"tfoot")(51,"tr",12)(52,"td",13),t._uU(53),t.qZA()(),t.TgZ(54,"tr",12)(55,"td",13),t._uU(56),t.qZA()()()()()()),2&r&&(t.xp6(2),t.Oqu(t.lcZ(3,16,"OrderDetails")),t.xp6(3),t.hij("ClientName : ",(null==e.user?null:e.user.firstName)+" "+(null==e.user?null:e.user.lastName),""),t.xp6(2),t.hij("ClientPhone : ",null==e.user?null:e.user.phoneNumber,""),t.xp6(2),t.hij("ClientEmail : ",null==e.user?null:e.user.email,""),t.xp6(3),t.Q6J("ngIf",""!=e.order.orderDetails),t.xp6(1),t.Q6J("ngIf",""==e.order.orderDetails),t.xp6(2),t.hij("OrderAddress : ",e.order.userAddress,""),t.xp6(2),t.hij("OrderDate : ",t.xi3(18,18,e.order.orderDate,"EEEE d/M/yyyy h:mm a"),""),t.xp6(3),t.hij("TotalOrder : ",e.order.totalOrder,""),t.xp6(2),t.Q6J("ngIf",0==e.order.adminRefuse),t.xp6(1),t.Q6J("ngIf",1==e.order.clientCancle),t.xp6(1),t.Q6J("ngIf",1==e.order.adminRefuse),t.xp6(25),t.Q6J("ngForOf",e.orderItems)("ngForTrackBy",e.trackProduct),t.xp6(4),t.hij(" Total : ",e.order.totalOrder," "),t.xp6(3),t.hij(" TotalOrderClient : ",e.totalOrder()," "))},dependencies:[p.sg,p.O5,c.rH,p.uU,m.X$],styles:["td.noHover[_ngcontent-%COMP%]:hover{background-color:#212529!important;color:#fff!important}table[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{cursor:pointer}"]});const Y=[{path:"",component:l,title:"Order Details",resolve:[f.n]}];class d{}d.\u0275fac=function(r){return new(r||d)},d.\u0275mod=t.oAB({type:d}),d.\u0275inj=t.cJS({imports:[c.Bz.forChild(Y),c.Bz]});class a{}a.\u0275fac=function(r){return new(r||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[p.ez,d,m.aw]})}}]);