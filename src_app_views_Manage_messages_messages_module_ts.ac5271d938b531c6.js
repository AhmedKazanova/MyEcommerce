"use strict";(self.webpackChunkEcommerce=self.webpackChunkEcommerce||[]).push([["src_app_views_Manage_messages_messages_module_ts"],{7919:(L,m,o)=>{o.r(m),o.d(m,{MessagesModule:()=>l});var c=o(6895),d=o(9197),_=o(8547),M=o(727),x=o(8724),v=o(5079),f=o(2340),e=o(4650),h=o(4463),C=o(5760),u=o(4006);const I=["audioOption"],A=["chat"];function S(i,t){if(1&i&&(e.TgZ(0,"span",14),e._uU(1),e.qZA()),2&i){const s=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",s.messagesNotSeen.length," ")}}function b(i,t){if(1&i&&e._UZ(0,"img",15),2&i){const s=e.oxw(2).$implicit,n=e.oxw();e.s9C("src",n.url+s.userImage,e.LSH)}}function y(i,t){1&i&&e._UZ(0,"img",16)}function T(i,t){if(1&i){const s=e.EpF();e.TgZ(0,"li",9),e.NdJ("click",function(){e.CHM(s);const r=e.oxw().$implicit,p=e.oxw();return e.KtG(p.showUserMessage(r))}),e.YNc(1,S,2,1,"span",10),e.YNc(2,b,1,1,"img",11),e.YNc(3,y,1,0,"img",12),e.TgZ(4,"span",13),e._uU(5),e.qZA()()}if(2&i){const s=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",s.messagesNotSeen.length>0),e.xp6(1),e.Q6J("ngIf",s.userImage),e.xp6(1),e.Q6J("ngIf",!s.userImage),e.xp6(2),e.Oqu(s.name)}}function U(i,t){if(1&i&&(e.ynx(0),e.YNc(1,T,6,4,"li",8),e.BQk()),2&i){const s=t.$implicit,n=e.oxw();e.xp6(1),e.Q6J("ngIf",s.id!=n.personeInfo.userSendID)}}function Z(i,t){if(1&i&&e._UZ(0,"img",39),2&i){const s=e.oxw(4);e.s9C("src",s.url+s.userModel.userinfo.userImage,e.LSH)}}function D(i,t){1&i&&e._UZ(0,"img",40)}function H(i,t){if(1&i&&(e.TgZ(0,"li",32)(1,"span",33),e.YNc(2,Z,1,1,"img",34),e.YNc(3,D,1,0,"img",35),e.TgZ(4,"span",36),e._uU(5),e.qZA(),e.TgZ(6,"span",37),e._uU(7),e.qZA()(),e.TgZ(8,"span",38),e._uU(9),e.ALo(10,"date"),e.qZA()()),2&i){const s=e.oxw().$implicit,n=e.oxw(2);e.xp6(2),e.Q6J("ngIf",n.userModel.userinfo.userImage),e.xp6(1),e.Q6J("ngIf",!n.userModel.userinfo.userImage),e.xp6(2),e.Oqu(n.userModel.userinfo.name),e.xp6(2),e.Oqu(s.text),e.xp6(2),e.Oqu(e.Dn7(10,5,s.date,"dd-MM-yyyy hh:mm a","UTC"))}}function w(i,t){if(1&i&&(e.TgZ(0,"li",41)(1,"span",42),e._uU(2),e.qZA(),e.TgZ(3,"span",38),e._uU(4),e.ALo(5,"date"),e.qZA()()),2&i){const s=e.oxw().$implicit;e.xp6(2),e.Oqu(s.text),e.xp6(2),e.Oqu(e.Dn7(5,2,s.date,"dd-MM-yyyy hh:mm a","UTC"))}}function O(i,t){if(1&i&&(e.ynx(0),e.YNc(1,H,11,9,"li",30),e.YNc(2,w,6,6,"li",31),e.BQk()),2&i){const s=t.$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("ngIf",s.userSendID==n.personeInfo.userReceiverID),e.xp6(1),e.Q6J("ngIf",s.userSendID==n.personeInfo.userSendID&&s.userReceiverID==n.personeInfo.userReceiverID)}}const N=function(i){return["/admin/userdatails",i]};function k(i,t){if(1&i){const s=e.EpF();e.TgZ(0,"div",17)(1,"span",18)(2,"a",19),e._uU(3),e.qZA()(),e.TgZ(4,"div",20,21)(6,"ul",22),e.YNc(7,O,3,2,"ng-container",4),e.qZA()(),e.TgZ(8,"div",23)(9,"div",24)(10,"textarea",25),e.NdJ("keyup.enter",function(){e.CHM(s);const r=e.oxw();return e.KtG(r.sendMessage())})("ngModelChange",function(r){e.CHM(s);const p=e.oxw();return e.KtG(p.personeInfo.text=r)}),e.qZA()(),e.TgZ(11,"div",26)(12,"button",27),e.NdJ("click",function(){e.CHM(s);const r=e.oxw();return e.KtG(r.sendMessage())}),e.O4$(),e.TgZ(13,"svg",28),e._UZ(14,"path",29),e.qZA()()()()()}if(2&i){const s=e.oxw();e.xp6(1),e.Q6J("ngClass",s.userModel.userinfo?"text-dark":"text-white"),e.xp6(1),e.Q6J("routerLink",e.VKq(5,N,s.userModel.userinfo.id)),e.xp6(1),e.Oqu(s.userModel.userinfo.name),e.xp6(4),e.Q6J("ngForOf",s.userModel.usermessages),e.xp6(3),e.Q6J("ngModel",s.personeInfo.text)}}class g{constructor(t,s){this._TranslateService=t,this._ApiserviceService=s,this.personeInfo={text:"",userSendID:"",userReceiverID:"",date:(new Date).toString(),seen:!1},this.usersArr=[],this.userAlreadySendMessage=[],this.AllUserMessages=[],this.userMessagesArr=[],this.userModel={userinfo:"",usermessages:[]},this.callApiGetMessages=new M.w0,this.lang="",this.SubscriptionArr=[],this.url=`${f.N.imageUrl}`}ngOnInit(){this.language();let t=this._ApiserviceService.UserDataFromToken();null!=t&&(this.personeInfo.userSendID=t.ID),this.startConnection(),"Connecting"==this.Hub_Connection?.state?this.askServerListener():alert("\u0647\u0646\u0627\u0643 \u062e\u0637\u0627 \u0645\u0646 \u0641\u0636\u0644\u0643 \u0627\u0639\u062f \u0627\u0644\u062a\u062d\u062f\u064a\u062b"),this.getMessages()}language(){this.lang=this._TranslateService.currentLang;let t=this._TranslateService.onLangChange.subscribe({next:s=>{this.lang=s.lang}});this.SubscriptionArr.push(t)}startConnection(){this.Hub_Connection=(new x.s).withUrl(`${f.N.signalrUrl}`,{skipNegotiation:!0,transport:v.n.WebSockets}).build(),this.Hub_Connection.start().then(()=>{}).catch(t=>{console.error("Error Hub Connection",t),alert("Error Hub Start Connection")})}getMessages(){this.callApiGetMessages=this._ApiserviceService.get("messages").subscribe({next:t=>{this.usersArr=t.users,this.AllUserMessages=t.messages;for(let s=0;s<this.usersArr.length;s++)for(let n=0;n<this.AllUserMessages.length;n++)this.usersArr[s].id==this.AllUserMessages[n].userSendID&&(this.userAlreadySendMessage.find(r=>r.id==this.usersArr[s].id)||(this.usersArr[s].messagesNotSeen=this.AllUserMessages.filter(r=>r.userSendID==this.usersArr[s].id).filter(r=>0==r.seen),this.userAlreadySendMessage.push(this.usersArr[s])))}})}askServerListener(){this.Hub_Connection?.on("sendMessage",t=>{if((this.personeInfo.userSendID==t.userSendID||t.userReceiverID==this.personeInfo.userSendID)&&(this.userModel.usermessages.push(t),setTimeout(()=>{this.chat.nativeElement.scrollTop=this.chat.nativeElement.scrollHeight*this.chat.nativeElement.scrollHeight,this.audioPlayerRef.nativeElement.play()},50)),this.AllUserMessages.push(t),this.userAlreadySendMessage.find(s=>s.id==t.userSendID))for(let s=0;s<this.userAlreadySendMessage.length;s++)this.userAlreadySendMessage[s].messagesNotSeen=this.AllUserMessages.filter(n=>n.userSendID==this.userAlreadySendMessage[s].id).filter(n=>0==n.seen);else{this.userAlreadySendMessage.push(this.usersArr.find(s=>s.id==t.userSendID));for(let s=0;s<this.userAlreadySendMessage.length;s++)this.userAlreadySendMessage[s].messagesNotSeen=this.AllUserMessages.filter(n=>n.userSendID==this.userAlreadySendMessage[s].id).filter(n=>0==n.seen)}})}sendMessage(){"Disconnected"!=this.Hub_Connection?.state?"Connected"==this.Hub_Connection?.state&&(""==this.personeInfo.text.trim()?alert("Message Empty"):""==this.personeInfo.userReceiverID||null==this.personeInfo.userReceiverID||null==this.personeInfo.userReceiverID?alert("Select User"):this.Hub_Connection?.invoke("sendMessage",this.personeInfo).then(()=>{this.personeInfo.text="",setTimeout(()=>{this.chat.nativeElement.scrollTop=this.chat.nativeElement.scrollHeight*this.chat.nativeElement.scrollHeight},50)}).catch(t=>console.error(t))):alert("\u062a\u0627\u0643\u062f \u0645\u0646 \u0627\u062a\u0635\u0627\u0644\u0643 \u0628\u0627\u0644\u0627\u0646\u062a\u0631\u0646\u062a \u062b\u0645 \u0627\u0639\u062f \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0635\u0641\u062d\u0629")}showUserMessage(t){if("Disconnected"!=this.Hub_Connection?.state){if("Connected"==this.Hub_Connection?.state){this.personeInfo.userReceiverID=t.id,this.userModel.userinfo=this.usersArr.find(s=>s.id==t.id),this.userModel.usermessages=this.AllUserMessages.filter(s=>s.userSendID===t.id);for(let s=0;s<this.AllUserMessages.length;s++)this.AllUserMessages[s].userReceiverID==t.id&&this.userModel.usermessages.push(this.AllUserMessages[s]);this.userModel.usermessages.sort((s,n)=>s.id-n.id),this.Hub_Connection?.invoke("SeenMessage",t.id,this.userModel.usermessages).then(()=>{}).catch(s=>console.error(s)),this.Hub_Connection?.on("SeenMessage",s=>{if(1==s){for(let n=0;n<this.userAlreadySendMessage.find(r=>r.id==t.id).messagesNotSeen.filter(r=>r.userSendID===t.id).length;n++)this.userAlreadySendMessage.find(r=>r.id==t.id).messagesNotSeen.filter(r=>r.userSendID===t.id)[n].seen=!0;this.userAlreadySendMessage.find(n=>n.id==t.id).messagesNotSeen=this.userAlreadySendMessage.find(n=>n.id==t.id).messagesNotSeen.filter(n=>0==n.seen)}}),setTimeout(()=>{this.chat.nativeElement.scrollTop=this.chat.nativeElement.scrollHeight*this.chat.nativeElement.scrollHeight},50)}}else alert("\u062a\u0627\u0643\u062f \u0645\u0646 \u0627\u062a\u0635\u0627\u0644\u0643 \u0628\u0627\u0644\u0627\u0646\u062a\u0631\u0646\u062a \u062b\u0645 \u0627\u0639\u062f \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0635\u0641\u062d\u0629")}ngOnDestroy(){for(let t=0;t<this.SubscriptionArr.length;t++)this.SubscriptionArr[t].unsubscribe();this.callApiGetMessages.unsubscribe(),this.Hub_Connection?.off(""),"Connecting"==this.Hub_Connection?.state&&this.Hub_Connection?.stop()}}g.\u0275fac=function(t){return new(t||g)(e.Y36(h.sK),e.Y36(C.O))},g.\u0275cmp=e.Xpm({type:g,selectors:[["app-messages"]],viewQuery:function(t,s){if(1&t&&(e.Gf(I,5),e.Gf(A,5)),2&t){let n;e.iGM(n=e.CRH())&&(s.audioPlayerRef=n.first),e.iGM(n=e.CRH())&&(s.chat=n.first)}},decls:10,vars:5,consts:[[1,"container-fluid","Chat","mb-5"],[1,"d-flex","flex-wrap","justify-content-between"],[1,"col-12","col-md-3","mt-3","MessagesList"],[1,"py-3","fs-2","d-block","px-2"],[4,"ngFor","ngForOf"],["class","col-12 col-md-7 mx-auto mt-3 position-relative",4,"ngIf"],["controls","","autoplay","false",1,"d-none"],["audioOption",""],["class","usersMessages position-relative",3,"click",4,"ngIf"],[1,"usersMessages","position-relative",3,"click"],["class","notNumber",4,"ngIf"],["class","col-12","alt","",3,"src",4,"ngIf"],["src","assets/images/avatar-placeholder.png","class","col-12","alt","",4,"ngIf"],[1,"mx-3"],[1,"notNumber"],["alt","",1,"col-12",3,"src"],["src","assets/images/avatar-placeholder.png","alt","",1,"col-12"],[1,"col-12","col-md-7","mx-auto","mt-3","position-relative"],[1,"py-3","fs-2","d-block","text-center","px-2",3,"ngClass"],[1,"text-dark",3,"routerLink"],[1,"chat","p-2"],["chat",""],[1,"col-12","p-0"],[1,"d-flex","align-items-center"],[1,"col-10"],["cols","5","rows","3",1,"form-control","fs-3",3,"ngModel","keyup.enter","ngModelChange"],[1,"col-2","px-2"],[1,"btn","btnSend","fs-2","d-block","col-12",3,"click"],["width","30","height","30","fill","#1fa855","viewBox","0 0 16 16",1,"bi","bi-send"],["d","M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576 6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"],["class","alert alert-primary mb-1 col-6 col-md-5 AdminChat",4,"ngIf"],["class","alert alert-primary mb-1 col-6 col-md-5 UserChat",4,"ngIf"],[1,"alert","alert-primary","mb-1","col-6","col-md-5","AdminChat"],[1,"d-block","fs-4","text-dark"],["class","","alt","",3,"src",4,"ngIf"],["src","assets/images/avatar-placeholder.png","class","","alt","",4,"ngIf"],[1,"mx-2"],[1,"d-block","my-2","px-1"],["dir","ltr",1,"fs-6"],["alt","",1,"",3,"src"],["src","assets/images/avatar-placeholder.png","alt","",1,""],[1,"alert","alert-primary","mb-1","col-6","col-md-5","UserChat"],[1,"d-block","fs-3","text-dark"]],template:function(t,s){1&t&&(e.TgZ(0,"section",0)(1,"div",1)(2,"ul",2)(3,"span",3),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.YNc(6,U,2,1,"ng-container",4),e.qZA(),e.YNc(7,k,15,7,"div",5),e.qZA()(),e._UZ(8,"audio",6,7)),2&t&&(e.xp6(4),e.Oqu(e.lcZ(5,3,"Messages")),e.xp6(2),e.Q6J("ngForOf",s.userAlreadySendMessage),e.xp6(1),e.Q6J("ngIf",s.userModel.userinfo.name))},dependencies:[c.mk,c.sg,c.O5,d.rH,u.Fj,u.JJ,u.On,c.uU,h.X$],styles:[".usersMessages[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #ffc107;border-radius:5px;padding:7px;margin-bottom:10px;font-size:1.6rem}.usersMessages[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:7rem;min-height:7rem;max-height:7rem;border-radius:50%}ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{cursor:pointer;list-style:none}.scrollDown[_ngcontent-%COMP%]{position:absolute;bottom:26%;right:5px;z-index:999999;background-color:#deb887;padding:5px 6px;border-radius:50%;cursor:pointer}.chat[_ngcontent-%COMP%]{min-height:60vh;max-height:60vh;overflow-y:scroll;border:1px solid #ccc}.chat[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:30px;height:30px;border-radius:50%}.MessagesList[_ngcontent-%COMP%]{max-height:90vh;overflow-y:scroll}.notNumber[_ngcontent-%COMP%]{position:absolute;background-color:#1876f2;color:#fff;left:5px;top:5px;border-radius:50%;padding:0 6px;font-size:1.4rem}.btnSend[_ngcontent-%COMP%]{box-shadow:none!important}"]});const J=[{path:"",component:g,title:"All Messages",resolve:[_.B]}];class a{}a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[d.Bz.forChild(J),d.Bz]});class l{}l.\u0275fac=function(t){return new(t||l)},l.\u0275mod=e.oAB({type:l}),l.\u0275inj=e.cJS({imports:[c.ez,a,h.aw,u.u5]})}}]);