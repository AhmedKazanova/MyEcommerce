"use strict";(self.webpackChunkEcommerce=self.webpackChunkEcommerce||[]).push([["src_app_views_user_chat_chat_module_ts"],{3930:(y,d,i)=>{i.r(d),i.d(d,{ChatModule:()=>a});var c=i(6895),g=i(9197),m=i(8547),f=i(8724),C=i(5079),v=i(2340),e=i(4650),p=i(4463),b=i(5760),h=i(4006);const x=["chat"];function M(o,t){if(1&o&&(e.TgZ(0,"li",16)(1,"span",17)(2,"span",18),e._uU(3,"Admin"),e.qZA(),e.TgZ(4,"span",19),e._uU(5),e.qZA()(),e.TgZ(6,"span",20),e._uU(7),e.ALo(8,"date"),e.qZA()()),2&o){const n=e.oxw().$implicit;e.xp6(5),e.Oqu(n.text),e.xp6(2),e.Oqu(e.Dn7(8,2,n.date,"dd-MM-yyyy hh:mm a","UTC"))}}function A(o,t){if(1&o&&(e.TgZ(0,"li",21)(1,"span",22),e._uU(2),e.qZA(),e.TgZ(3,"span",20),e._uU(4),e.ALo(5,"date"),e.qZA()()),2&o){const n=e.oxw().$implicit;e.xp6(2),e.Oqu(n.text),e.xp6(2),e.Oqu(e.Dn7(5,2,n.date,"dd-MM-yyyy hh:mm a","UTC"))}}function I(o,t){if(1&o&&(e.ynx(0),e.YNc(1,M,9,6,"li",14),e.YNc(2,A,6,6,"li",15),e.BQk()),2&o){const n=t.$implicit,s=e.oxw();e.xp6(1),e.Q6J("ngIf",n.userSendID==s.personeInfo.userReceiverID),e.xp6(1),e.Q6J("ngIf",n.userSendID==s.personeInfo.userSendID)}}class l{constructor(t,n,s){this._Router=t,this._TranslateService=n,this._ApiserviceService=s,this.SubscriptionArr=[],this.personeInfo={text:"",userSendID:"",userReceiverID:"",date:(new Date).toString(),seen:!1},this.lang="",this.getMsgArr=[],this.AllMessages=[]}ngOnInit(){let t=this._ApiserviceService.UserDataFromToken();null!=t&&"Admin"==t.Roles&&this._Router.navigate(["/admin/messages"]),this.language(),this.getAdminId(),this.getUserId(),this.startConnection(),this.getMessages(),"Connecting"==this.Hub_Connection?.state?this.askServerListener():alert("\u0647\u0646\u0627\u0643 \u062e\u0637\u0627 \u0645\u0646 \u0641\u0636\u0644\u0643 \u0627\u0639\u062f \u0627\u0644\u062a\u062d\u062f\u064a\u062b"),setTimeout(()=>{this.chat.nativeElement.scrollTop=this.chat.nativeElement.scrollHeight*this.chat.nativeElement.scrollHeight},800)}language(){this.lang=this._TranslateService.currentLang;let t=this._TranslateService.onLangChange.subscribe({next:n=>{this.lang=n.lang}});this.SubscriptionArr.push(t)}startConnection(){this.Hub_Connection=(new f.s).withUrl(`${v.N.signalrUrl}`,{skipNegotiation:!0,transport:C.n.WebSockets}).build(),this.Hub_Connection.start().then(()=>{}).catch(t=>{console.error("Error Hub Connection",t),alert("Error Hub Start Connection")})}getAdminId(){let t=this._ApiserviceService.get("mangercontrol/adminId").subscribe({next:n=>{this.personeInfo.userReceiverID=n}});this.SubscriptionArr.push(t)}getUserId(){let t=this._ApiserviceService.UserDataFromToken();null!=t&&(this.personeInfo.userSendID=t.ID)}getMessages(){let t=this._ApiserviceService.getById("Messages",this.personeInfo.userSendID).subscribe({next:n=>{for(let s=0;s<n.adminReply.length;s++)this.AllMessages.push(n.adminReply[s]);for(let s=0;s<n.userMessages.length;s++)this.AllMessages.push(n.userMessages[s]);this.AllMessages.sort((s,u)=>s.id-u.id)}});this.SubscriptionArr.push(t)}askServerListener(){this.Hub_Connection?.on("sendMessage",t=>{(t.userReceiverID==this.personeInfo.userSendID||t.userSendID==this.personeInfo.userSendID)&&(this.AllMessages.push(t),setTimeout(()=>{this.chat.nativeElement.scrollTop=this.chat.nativeElement.scrollHeight*this.chat.nativeElement.scrollHeight},600))})}sendMessage(){"Disconnected"!=this.Hub_Connection?.state?"Connected"==this.Hub_Connection?.state&&(""==this.personeInfo.text.trim()?alert("Message Empty"):this.Hub_Connection?.invoke("sendMessage",this.personeInfo).then(()=>{this.personeInfo.text="",setTimeout(()=>{this.chat.nativeElement.scrollTop=this.chat.nativeElement.scrollHeight*this.chat.nativeElement.scrollHeight},600)}).catch(t=>{console.error("Error Hub Connection",t),alert("Error Hub Start Connection")})):alert("\u062a\u0627\u0643\u062f \u0645\u0646 \u0627\u062a\u0635\u0627\u0644\u0643 \u0628\u0627\u0644\u0627\u0646\u062a\u0631\u0646\u062a \u062b\u0645 \u0627\u0639\u062f \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0635\u0641\u062d\u0629")}ngOnDestroy(){for(let t=0;t<this.SubscriptionArr.length;t++)this.SubscriptionArr[t].unsubscribe();this.Hub_Connection?.off(""),"Connecting"==this.Hub_Connection?.state&&this.Hub_Connection?.stop()}}l.\u0275fac=function(t){return new(t||l)(e.Y36(g.F0),e.Y36(p.sK),e.Y36(b.O))},l.\u0275cmp=e.Xpm({type:l,selectors:[["app-chat"]],viewQuery:function(t,n){if(1&t&&e.Gf(x,5),2&t){let s;e.iGM(s=e.CRH())&&(n.chat=s.first)}},decls:15,vars:2,consts:[[1,"container-fluid","Chat","mb-5"],[1,"col-12","col-md-7","mx-auto","mt-3","position-relative"],[1,"py-3","fs-2","d-block","text-center","px-2"],[1,"chat","p-2"],["chat",""],[1,"col-12","p-0"],[4,"ngFor","ngForOf"],[1,"d-flex","align-items-center"],[1,"col-10"],["cols","5","rows","3",1,"form-control","fs-3",3,"ngModel","keyup.enter","ngModelChange"],[1,"col-2","px-2"],[1,"btn","btnSend","fs-2","d-block","col-12",3,"click"],["width","30","height","30","fill","#1fa855","viewBox","0 0 16 16",1,"bi","bi-send"],["d","M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576 6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"],["class","alert alert-primary mb-1 col-6 col-md-5 AdminChat",4,"ngIf"],["class","alert alert-primary mb-1 col-6 col-md-5 UserChat",4,"ngIf"],[1,"alert","alert-primary","mb-1","col-6","col-md-5","AdminChat"],[1,"d-block","fs-4","text-dark"],[1,"mx-2"],[1,"d-block","my-2","px-1"],["dir","ltr",1,"fs-6"],[1,"alert","alert-primary","mb-1","col-6","col-md-5","UserChat"],[1,"d-block","fs-3","text-dark"]],template:function(t,n){1&t&&(e.TgZ(0,"section",0)(1,"div",1)(2,"h6",2),e._uU(3,"Admin"),e.qZA(),e.TgZ(4,"div",3,4)(6,"ul",5),e.YNc(7,I,3,2,"ng-container",6),e.qZA()(),e.TgZ(8,"div",7)(9,"div",8)(10,"textarea",9),e.NdJ("keyup.enter",function(){return n.sendMessage()})("ngModelChange",function(u){return n.personeInfo.text=u}),e.qZA()(),e.TgZ(11,"div",10)(12,"button",11),e.NdJ("click",function(){return n.sendMessage()}),e.O4$(),e.TgZ(13,"svg",12),e._UZ(14,"path",13),e.qZA()()()()()()),2&t&&(e.xp6(7),e.Q6J("ngForOf",n.AllMessages),e.xp6(3),e.Q6J("ngModel",n.personeInfo.text))},dependencies:[c.sg,c.O5,h.Fj,h.JJ,h.On,c.uU],styles:[".usersMessages[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #ffc107;border-radius:5px;padding:7px;margin-bottom:10px;font-size:1.6rem}.usersMessages[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:7rem;min-height:7rem;max-height:7rem;border-radius:50%}ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{cursor:pointer;list-style:none}.scrollDown[_ngcontent-%COMP%]{position:absolute;bottom:26%;right:5px;z-index:999999;background-color:#deb887;padding:5px 6px;border-radius:50%;cursor:pointer}.chat[_ngcontent-%COMP%]{min-height:60vh;max-height:60vh;overflow-y:scroll;border:1px solid #ccc}.chat[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:30px;height:30px;border-radius:50%}.MessagesList[_ngcontent-%COMP%]{max-height:90vh;overflow-y:scroll}.notNumber[_ngcontent-%COMP%]{position:absolute;background-color:#1876f2;color:#fff;left:5px;top:5px;border-radius:50%;padding:0 6px;font-size:1.4rem}.btnSend[_ngcontent-%COMP%]{box-shadow:none!important}"]});const _=[{path:"",title:"Chat",component:l,resolve:[m.B]}];class r{}r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[g.Bz.forChild(_),g.Bz]});class a{}a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[c.ez,r,p.aw,h.u5]})}}]);